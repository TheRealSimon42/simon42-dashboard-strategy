# simon42 Dashboard Strategy

Eine modulare Dashboard-Strategy fÃ¼r Home Assistant, die automatisch Views basierend auf Bereichen, EntitÃ¤ten und deren ZustÃ¤nden generiert. WÃ¤chst mit dem User mit & ist sowohl fÃ¼r AnfÃ¤nger als auch Fortgeschrittene interessant.

## âœ¨ Highlights

- ğŸ¨ **Grafischer Konfigurator** - Keine YAML-Kenntnisse erforderlich
- ğŸ  **Automatische Raum-Erkennung** - Nutzt Home Assistant Areas & Devices
- ğŸ”§ **Granulare Entity-Kontrolle** - Verstecke einzelne Entities pro Raum und Domain
- ğŸ“Š **Intelligente Gruppierung** - Entities nach Domains und Status gruppiert
- ğŸ”„ **Drag & Drop** - Einfache Neuordnung von Bereichen
- ğŸ¯ **Label-System** - Globale Entity-Filterung via Labels
- ğŸ“± **Responsive Design** - Optimiert fÃ¼r Desktop, Tablet und Mobile

## ğŸ—ï¸ Architektur-Ãœbersicht

```
simon42-strategy/
â”œâ”€â”€ simon42-strategies-loader.js          # Entry Point - lÃ¤dt alle Module
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ simon42-dashboard-strategy.js     # Haupt-Strategy (generiert Dashboard-Struktur)
â”‚   â”œâ”€â”€ simon42-dashboard-strategy-editor.js  # GUI-Editor fÃ¼r Konfiguration
â”‚   â””â”€â”€ editor/
â”‚       â”œâ”€â”€ simon42-editor-handlers.js    # Event-Handler (Checkboxen, Drag&Drop, Expand)
â”‚       â”œâ”€â”€ simon42-editor-styles.js      # CSS fÃ¼r Editor (verschachtelte Struktur)
â”‚       â””â”€â”€ simon42-editor-template.js    # HTML-Template fÃ¼r Editor (Area â†’ Domain â†’ Entity)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ simon42-helpers.js                # Helper-Funktionen (Filterung, Sortierung)
â”‚   â”œâ”€â”€ simon42-data-collectors.js        # Datensammlung (Personen, Lichter, etc.)
â”‚   â”œâ”€â”€ simon42-badge-builder.js          # Badge-Erstellung
â”‚   â”œâ”€â”€ simon42-section-builder.js        # Section-Erstellung (Grid-Layouts)
â”‚   â””â”€â”€ simon42-view-builder.js           # View-Definitionen
â””â”€â”€ views/
    â”œâ”€â”€ simon42-view-room.js              # Raum-Details (pro Bereich, config-aware)
    â”œâ”€â”€ simon42-view-lights.js            # Lichter-Ãœbersicht
    â”œâ”€â”€ simon42-view-covers.js            # Rollos/VorhÃ¤nge
    â”œâ”€â”€ simon42-view-security.js          # Sicherheit (SchlÃ¶sser, TÃ¼ren, Fenster)
    â””â”€â”€ simon42-view-batteries.js         # Batterie-Status
```

## ğŸ”„ Datenfluss

1. **Loader** (`simon42-strategies-loader.js`) registriert alle Module
2. **Core Strategy** (`simon42-dashboard-strategy.js`):
   - Ruft HA-Registries ab (Areas, Devices, Entities)
   - Sammelt Daten via **Data Collectors**
   - Erstellt Sections via **Section Builder**
   - Generiert Views via **View Builder**
   - Ãœbergibt `groups_options` an View-Strategies
3. **View Strategies** werden fÃ¼r jeden Bereich/View dynamisch ausgefÃ¼hrt
   - Respektieren `groups_options` fÃ¼r Entity-Filterung

## ğŸ“ Datei-Beschreibungen

### Core

**`simon42-dashboard-strategy.js`**
- Haupteinstiegspunkt fÃ¼r Dashboard-Generierung
- `generate()`: Erstellt komplette Dashboard-Struktur
- Orchestriert Data Collection â†’ Section Building â†’ View Building
- Ãœbergibt `areas_options` an Area-Views
- Registriert sich als `ll-strategy-simon42-dashboard`

**`simon42-dashboard-strategy-editor.js`**
- GUI-Konfigurationseditor (Custom Element)
- Verwaltet Config-State: `show_energy`, `show_subviews`, `areas_display`, `areas_options`
- **Persistenter Expand-State** - Bereiche bleiben wÃ¤hrend Konfiguration aufgeklappt
- **Intelligentes Re-Rendering** - Verhindert unnÃ¶tige Re-Renders bei Config-Ã„nderungen
- Nutzt modulare Editor-Komponenten aus `editor/`
- Feuert `config-changed` Events bei Ã„nderungen

**`editor/simon42-editor-handlers.js`**
- Event-Handler fÃ¼r Editor-Interaktionen
- **Drag&Drop** fÃ¼r Area-Sortierung (Ã¼ber Drag-Handle)
- **Expand-Button-Listener** fÃ¼r Areas und Domain-Gruppen
- **Checkbox-Listener** auf drei Ebenen:
  - Area-Ebene (kompletter Bereich an/aus)
  - Domain-Gruppen-Ebene (alle Entities einer Domain an/aus)
  - Entity-Ebene (einzelne Entities an/aus)
- **Indeterminate-State-Verwaltung** fÃ¼r teilweise ausgewÃ¤hlte Gruppen
- **Dynamisches Entity-Loading** beim Aufklappen von Areas
- `getAreaGroupedEntities()`: Gruppiert Entities nach Domains (analog zu view-room.js)

**`editor/simon42-editor-styles.js`**
- CSS-Styles fÃ¼r Editor-UI
- **Verschachtelte Struktur**: Area â†’ Domain-Gruppe â†’ Entity
- Drag-Handle mit `cursor: grab/grabbing`
- Expand-Icons mit Rotation-Animation
- Indeterminate-Checkbox-Styling
- Entity-Liste mit Icons und IDs

**`editor/simon42-editor-template.js`**
- HTML-Template-Generierung fÃ¼r Editor
- **Hierarchische Struktur**:
  - Area-Liste mit Drag&Drop-Support
  - Domain-Gruppen (Beleuchtung, Klima, Rollos, etc.)
  - Entity-Liste mit Friendly-Names und IDs
- `renderAreaEntitiesHTML()`: Rendert Entity-Gruppen fÃ¼r einen Bereich

### Utils

**`simon42-helpers.js`**
- `getVisibleAreas()`: Filtert/sortiert Areas basierend auf Config
- `stripAreaName()`: Entfernt Raumnamen aus Entity-Namen
- `isEntityHiddenOrDisabled()`: PrÃ¼ft Registry-Status
- `sortByLastChanged()`: Sortierung nach letzter Ã„nderung
- `getExcludedLabels()`: Erstellt Liste von `no_dboard` Entities

**`simon42-data-collectors.js`**
- Sammelt spezifische Entity-Typen aus `hass.states`
- `collectPersons()`, `collectLights()`, `collectCovers()`
- `collectSecurityUnsafe()`: Locks, TÃ¼ren, Fenster (offen/unlocked)
- `collectBatteriesCritical()`: Batterien < 20%
- BerÃ¼cksichtigt `no_dboard` Label-Filter

**`simon42-badge-builder.js`**
- `createPersonBadges()`: Badges fÃ¼r Personen (home/away)
- Verwendet Visibility-Conditions fÃ¼r dynamische Anzeige

**`simon42-section-builder.js`**
- Erstellt Dashboard-Sections (Grid-Layouts)
- `createOverviewSection()`: Summary-Tiles (Lichter, Covers, Security, Batterien)
- `createAreasSection()`: Area-Cards
- `createWeatherEnergySection()`: Wetter + Energie-Verteilung

**`simon42-view-builder.js`**
- Definiert View-Strukturen
- `createOverviewView()`: Haupt-View mit Badges/Sections
- `createUtilityViews()`: Lichter/Covers/Security/Batterien (mit subview-Flag)
- `createAreaViews()`: Pro Bereich ein View mit `groups_options`

### Views

**`simon42-view-room.js`** â­ Config-Aware
- Detailansicht pro Raum
- Filtert Entities nach Area-ZugehÃ¶rigkeit (direct + device-based)
- Gruppiert nach Domains: lights, covers, climate, media_player, scenes, etc.
- **Respektiert `groups_options`**:
  - Filtert versteckte Entities aus `groups_options[domain].hidden`
  - Sortiert nach `groups_options[domain].order`
- `applyGroupFilter()`: Wendet Config-Filter pro Domain-Gruppe an
- Erstellt Sensor-Badges (Temperatur, Luftfeuchtigkeit, PM2.5/10, CO2, VOC, Motion, Occupancy)
- Respektiert `area.temperature_entity_id` und `area.humidity_entity_id` als primÃ¤re Sensoren
- Sections: Beleuchtung, Klima, Rollos, VorhÃ¤nge, Medien, Szenen, Sonstiges

**`simon42-view-lights.js`**
- Alle Lichter gruppiert nach Status (on/off)
- Batch-Aktionen via Heading-Badges (alle an/aus)
- Tile-Cards mit `light-brightness` Feature

**`simon42-view-covers.js`**
- Covers gefiltert nach `device_classes` (blind, curtain, shutter, etc.)
- Gruppiert nach Status (open/closed)
- Batch-Aktionen fÃ¼r Ã¶ffnen/schlieÃŸen

**`simon42-view-security.js`**
- Gruppiert nach: Locks, Doors/Gates, Garages, Windows/Sensors
- Jeweils aufgeteilt in offen/geschlossen bzw. locked/unlocked
- Verwendet `device_class` fÃ¼r Kategorisierung

**`simon42-view-batteries.js`**
- Batterie-Entities gruppiert nach Status:
  - Kritisch (< 20%) - rot
  - Niedrig (20-50%) - gelb
  - Gut (> 50%) - grÃ¼n
- Zeigt `last_changed` in Tiles

## ğŸ›ï¸ Konfiguration

### Basis-Konfiguration

```yaml
strategy:
  type: custom:simon42-dashboard
  show_energy: true              # Standard: true
  show_subviews: false           # Standard: false (utility views als subviews)
  areas_display:
    hidden: [area_id1, area_id2] # Versteckte Bereiche
    order: [area_id3, area_id1]  # Custom Sortierung
```

### Erweiterte Konfiguration (Entity-Filterung)

```yaml
strategy:
  type: custom:simon42-dashboard
  show_energy: true
  show_subviews: false
  areas_display:
    hidden: [bad, garage]
    order: [wohnzimmer, kueche, schlafzimmer]
  areas_options:
    wohnzimmer:
      groups_options:
        lights:
          hidden: [light.stehlampe, light.alte_lampe]
          order: [light.decke, light.couch, light.schrank]
        climate:
          hidden: [climate.old_thermostat]
        covers:
          hidden: [cover.rollo_links]
    kueche:
      groups_options:
        lights:
          hidden: [light.dunstabzug]
        switches:
          hidden: [switch.kaffeemaschine]
```

### Config-Struktur

- **`show_energy`** (boolean, Standard: `true`): Zeigt Energie-Dashboard in Ãœbersicht
- **`show_subviews`** (boolean, Standard: `false`): Zeigt Utility-Views in Navigation
- **`areas_display`** (object): Bereich-Verwaltung
  - `hidden` (array): Liste versteckter Area-IDs
  - `order` (array): Sortierung der Areas
- **`areas_options`** (object): Entity-Verwaltung pro Bereich
  - `{area_id}` (object): Optionen fÃ¼r einen Bereich
    - `groups_options` (object): Domain-spezifische Optionen
      - `{domain}` (object): Optionen fÃ¼r eine Domain-Gruppe
        - `hidden` (array): Versteckte Entity-IDs
        - `order` (array): Sortierung der Entities

## ğŸ¨ Grafischer Konfigurator

Der Editor bietet eine intuitive BenutzeroberflÃ¤che:

### Bereiche-Verwaltung
- â˜° **Drag-Handle**: Ziehe Bereiche, um die Reihenfolge zu Ã¤ndern
- â˜‘ï¸ **Area-Checkbox**: Bereiche ein-/ausblenden
- â–¶ **Expand-Button**: Klappt Bereich auf fÃ¼r Entity-Verwaltung

### Domain-Gruppen
Nach dem Aufklappen eines Bereichs:
- â˜‘ï¸ **Gruppen-Checkbox**: Alle Entities einer Domain ein-/ausblenden
  - âŠŸ **Indeterminate-State**: Bei teilweise ausgewÃ¤hlten Entities
- ğŸ”§ **Domain-Icons**: Visuelle Unterscheidung (Beleuchtung, Klima, etc.)
- ğŸ“Š **Entity-Count**: Anzahl der Entities in der Gruppe
- â–¶ **Expand-Button**: Klappt Entity-Liste auf

### Entity-Liste
- â˜‘ï¸ **Entity-Checkbox**: Einzelne Entities ein-/ausblenden
- ğŸ“ **Friendly-Name**: Lesbarer Entity-Name
- ğŸ”¤ **Entity-ID**: Technische ID (monospace)

### Features
- **Persistenter State**: Aufgeklappte Bereiche bleiben wÃ¤hrend Konfiguration offen
- **Echtzeit-Updates**: Config wird automatisch gespeichert
- **Intelligente Gruppierung**: Automatische Erkennung von Entity-Domains
- **Visuelle Hierarchie**: Area â†’ Domain â†’ Entity

## ğŸ·ï¸ Label-System

### Globale Labels

- **`no_dboard`**: Entity wird **Ã¼berall** im Dashboard ausgeschlossen
  - Wird nicht in Ãœbersichten angezeigt
  - Wird nicht im Konfigurator gelistet
  - Ideal fÃ¼r Hilfs-Entities und Debug-Sensoren
  
- **`show_dboard`**: (reserviert fÃ¼r zukÃ¼nftige Nutzung)

### Kombinierbarkeit

Labels und `groups_options` ergÃ¤nzen sich:
1. **`no_dboard` Label**: Globale Exklusion (wird nie gelistet)
2. **`groups_options.hidden`**: Bereich-spezifische Exklusion (via Konfigurator)

**Beispiel:**
```yaml
# Global versteckt (Label):
- light.debug_light (no_dboard)

# Im Wohnzimmer versteckt (Config):
- light.stehlampe (groups_options.lights.hidden)
```

## ğŸ”Œ Custom Elements

- `ll-strategy-simon42-dashboard` - Haupt-Strategy
- `simon42-dashboard-strategy-editor` - Config-Editor
- `ll-strategy-simon42-view-room` - Raum-View
- `ll-strategy-simon42-view-lights` - Lichter-View
- `ll-strategy-simon42-view-covers` - Covers-View
- `ll-strategy-simon42-view-security` - Security-View
- `ll-strategy-simon42-view-batteries` - Batterie-View

## ğŸ“‹ Entity-Filterung

Entities werden in folgender Reihenfolge gefiltert:

1. **Label-Exklusion** (`no_dboard`)
   - Globale Filterung via Labels
   - Wird nirgendwo im Dashboard angezeigt

2. **Area-ZugehÃ¶rigkeit**
   - Entities mit direkter Area-Zuweisung
   - Entities Ã¼ber Device-Area-Zuweisung

3. **Entity Category** 
   - Keine `config` oder `diagnostic` Entities

4. **Hidden/Disabled Status** (Registry)
   - Versteckte oder deaktivierte Entities

5. **Availability** 
   - Entity muss in `hass.states` existieren

6. **`groups_options.hidden`** â­ NEU
   - Bereich-spezifische Filterung via Konfigurator
   - Pro Domain konfigurierbar

## ğŸ¯ Besonderheiten

- **Modulares Design**: Jede Komponente hat klare Verantwortung
- **Dynamic Grouping**: Entities werden nach State/Klasse gruppiert
- **Batch Actions**: Heading-Badges fÃ¼r Gruppen-Aktionen
- **Area Binding**: Entities Ã¼ber direkte Area-ID oder Device-Area-ID
- **Badge Prioritization**: Area-spezifische Sensoren haben Vorrang
- **Name Stripping**: Automatische Entfernung von Raumnamen aus Entity-Namen
- **Config-Aware Views** â­: Room-Views respektieren `groups_options`
- **Persistent Editor State** â­: Keine Re-Renders wÃ¤hrend Konfiguration
- **Granulare Kontrolle** â­: Entity-Verwaltung auf Domain-Ebene

## ğŸ“¦ Installation

1. Kopiere alle Dateien nach `/config/www/simon42-strategy/`

2. FÃ¼ge zu `configuration.yaml` hinzu:
```yaml
lovelace:
  mode: storage
  resources:
    - url: /local/simon42-strategy/simon42-strategies-loader.js
      type: module
```

3. Starte Home Assistant neu

4. Erstelle ein neues Dashboard:
   - Dashboard â†’ â‹® â†’ Dashboard bearbeiten
   - Strategie-Typ auswÃ¤hlen: `simon42 Dashboard`
   - Konfiguriere Ã¼ber den grafischen Editor

## ğŸš€ Roadmap

- [ ] HinzufÃ¼gen von eigenen Views aus anderen Dashboards
- [ ] Entity-Sortierung per Drag & Drop im Editor
- [ ] Preset-Templates fÃ¼r verschiedene Use-Cases


## ğŸ¤ Beitragen

!!!Maintainers Wanted!!!

Contributions sind willkommen! Bitte erstelle einen Issue oder Pull Request (den du vorher bitte auf Herz & Nieren getestet hast ğŸ«¶) auf GitHub.


## ğŸ“„ Lizenz

Attribution-NonCommercial-ShareAlike 4.0 International - siehe LICENSE Datei fÃ¼r Details