# SIMON42 Dashboard Strategy

Eine modulare Dashboard-Strategy fÃ¼r Home Assistant, die automatisch Views basierend auf Bereichen, EntitÃ¤ten und deren ZustÃ¤nden generiert.

## ğŸ—ï¸ Architektur-Ãœbersicht

```
simon42-strategy/
â”œâ”€â”€ simon42-strategies-loader.js          # Entry Point - lÃ¤dt alle Module
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ simon42-dashboard-strategy.js     # Haupt-Strategy (generiert Dashboard-Struktur)
â”‚   â”œâ”€â”€ simon42-dashboard-strategy-editor.js  # GUI-Editor fÃ¼r Konfiguration
â”‚   â””â”€â”€ editor/
â”‚       â”œâ”€â”€ simon42-editor-handlers.js    # Event-Handler (Checkboxen, Drag&Drop)
â”‚       â”œâ”€â”€ simon42-editor-styles.js      # CSS fÃ¼r Editor
â”‚       â””â”€â”€ simon42-editor-template.js    # HTML-Template fÃ¼r Editor
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ simon42-helpers.js                # Helper-Funktionen (Filterung, Sortierung)
â”‚   â”œâ”€â”€ simon42-data-collectors.js        # Datensammlung (Personen, Lichter, etc.)
â”‚   â”œâ”€â”€ simon42-badge-builder.js          # Badge-Erstellung
â”‚   â”œâ”€â”€ simon42-section-builder.js        # Section-Erstellung (Grid-Layouts)
â”‚   â””â”€â”€ simon42-view-builder.js           # View-Definitionen
â””â”€â”€ views/
    â”œâ”€â”€ simon42-view-room.js              # Raum-Details (pro Bereich)
    â”œâ”€â”€ simon42-view-lights.js            # Lichter-Ãœbersicht
    â”œâ”€â”€ simon42-view-covers.js            # Rollos/VorhÃ¤nge
    â”œâ”€â”€ simon42-view-security.js          # Sicherheit (SchlÃ¶sser, TÃ¼ren, Fenster)
    â””â”€â”€ simon42-view-batteries.js         # Batterie-Status
```

## ğŸ”„ Datenfluss

1. **Loader** (`simon42-strategies-loader.js`) registriert alle Module
2. **Core Strategy** (`simon42-dashboard-strategy.js`):
   - Ruft HA-Registries ab (Areas, Devices, Entities)
   - Sammelt Daten via **Data Collectors**
   - Erstellt Sections via **Section Builder**
   - Generiert Views via **View Builder**
3. **View Strategies** werden fÃ¼r jeden Bereich/View dynamisch ausgefÃ¼hrt

## ğŸ“ Datei-Beschreibungen

### Core

**`simon42-dashboard-strategy.js`**
- Haupteinstiegspunkt fÃ¼r Dashboard-Generierung
- `generate()`: Erstellt komplette Dashboard-Struktur
- Orchestriert Data Collection â†’ Section Building â†’ View Building
- Registriert sich als `ll-strategy-simon42-dashboard`

**`simon42-dashboard-strategy-editor.js`**
- GUI-Konfigurationseditor (Custom Element)
- Verwaltet Config-State: `show_energy`, `show_subviews`, `areas_display`
- Nutzt modulare Editor-Komponenten aus `editor/`
- Feuert `config-changed` Events bei Ã„nderungen

**`editor/simon42-editor-handlers.js`**
- Event-Handler fÃ¼r Editor-Interaktionen
- Drag&Drop fÃ¼r Area-Sortierung
- Checkbox-Listener (Energie, Subviews, Area-Sichtbarkeit)

**`editor/simon42-editor-styles.js`**
- CSS-Styles fÃ¼r Editor-UI (Grid, Drag-Handles, Checkboxen)

**`editor/simon42-editor-template.js`**
- HTML-Template-Generierung fÃ¼r Editor
- Rendert Area-Liste mit Drag&Drop-Support

### Utils

**`simon42-helpers.js`**
- `getVisibleAreas()`: Filtert/sortiert Areas basierend auf Config
- `stripAreaName()`: Entfernt Raumnamen aus Entity-Namen
- `isEntityHiddenOrDisabled()`: PrÃ¼ft Registry-Status
- `sortByLastChanged()`: Sortierung nach letzter Ã„nderung

**`simon42-data-collectors.js`**
- Sammelt spezifische Entity-Typen aus `hass.states`
- `collectPersons()`, `collectLights()`, `collectCovers()`
- `collectSecurityUnsafe()`: Locks, TÃ¼ren, Fenster (offen/unlocked)
- `collectBatteriesCritical()`: Batterien < 20%
- BerÃ¼cksichtigt `no_dboard` Label-Filter

**`simon42-badge-builder.js`**
- `createPersonBadges()`: Badges fÃ¼r Personen (home/away)
- Verwendet Visibility-Conditions fÃ¼r dynamische Anzeige

**`simon42-section-builder.js`**
- Erstellt Dashboard-Sections (Grid-Layouts)
- `createOverviewSection()`: Summary-Tiles (Lichter, Covers, Security, Batterien)
- `createAreasSection()`: Area-Cards
- `createWeatherEnergySection()`: Wetter + Energie-Verteilung

**`simon42-view-builder.js`**
- Definiert View-Strukturen
- `createOverviewView()`: Haupt-View mit Badges/Sections
- `createUtilityViews()`: Lichter/Covers/Security/Batterien (mit subview-Flag)
- `createAreaViews()`: Pro Bereich ein View

### Views

**`simon42-view-room.js`**
- Detailansicht pro Raum
- Filtert Entities nach Area-ZugehÃ¶rigkeit (direct + device-based)
- Gruppiert nach Domains: lights, covers, climate, media_player, scenes, etc.
- Erstellt Sensor-Badges (Temperatur, Luftfeuchtigkeit, PM2.5/10, CO2, VOC, Motion, Occupancy)
- Respektiert `area.temperature_entity_id` und `area.humidity_entity_id` als primÃ¤re Sensoren
- Sections: Beleuchtung, Klima, Rollos, VorhÃ¤nge, Medien, Szenen, Sonstiges

**`simon42-view-lights.js`**
- Alle Lichter gruppiert nach Status (on/off)
- Batch-Aktionen via Heading-Badges (alle an/aus)
- Tile-Cards mit `light-brightness` Feature

**`simon42-view-covers.js`**
- Covers gefiltert nach `device_classes` (blind, curtain, shutter, etc.)
- Gruppiert nach Status (open/closed)
- Batch-Aktionen fÃ¼r Ã¶ffnen/schlieÃŸen

**`simon42-view-security.js`**
- Gruppiert nach: Locks, Doors/Gates, Garages, Windows/Sensors
- Jeweils aufgeteilt in offen/geschlossen bzw. locked/unlocked
- Verwendet `device_class` fÃ¼r Kategorisierung

**`simon42-view-batteries.js`**
- Batterie-Entities gruppiert nach Status:
  - Kritisch (< 20%) - rot
  - Niedrig (20-50%) - gelb
  - Gut (> 50%) - grÃ¼n
- Zeigt `last_changed` in Tiles

## ğŸ›ï¸ Konfiguration

```yaml
strategy:
  type: custom:simon42-dashboard
  show_energy: true              # Standard: true
  show_subviews: false           # Standard: false (utility views als subviews)
  areas_display:
    hidden: [area_id1, area_id2] # Versteckte Bereiche
    order: [area_id3, area_id1]  # Custom Sortierung
```

## ğŸ·ï¸ Label-System

- **`no_dboard`**: Entity wird Ã¼berall ausgeschlossen
- **`show_dboard`**: (reserviert fÃ¼r zukÃ¼nftige Nutzung)

## ğŸ”Œ Custom Elements

- `ll-strategy-simon42-dashboard` - Haupt-Strategy
- `simon42-dashboard-strategy-editor` - Config-Editor
- `ll-strategy-simon42-view-room` - Raum-View
- `ll-strategy-simon42-view-lights` - Lichter-View
- `ll-strategy-simon42-view-covers` - Covers-View
- `ll-strategy-simon42-view-security` - Security-View
- `ll-strategy-simon42-view-batteries` - Batterie-View

## ğŸ“‹ Entity-Filterung

Entities werden gefiltert nach:
1. Label-Exklusion (`no_dboard`)
2. Entity Category (keine `config`/`diagnostic`)
3. Hidden/Disabled Status (Registry)
4. Availability (`hass.states[entity_id]` existiert)

## ğŸ¯ Besonderheiten

- **Modulares Design**: Jede Komponente hat klare Verantwortung
- **Dynamic Grouping**: Entities werden nach State/Klasse gruppiert
- **Batch Actions**: Heading-Badges fÃ¼r Gruppen-Aktionen
- **Area Binding**: Entities Ã¼ber direkte Area-ID oder Device-Area-ID
- **Badge Prioritization**: Area-spezifische Sensoren haben Vorrang
- **Name Stripping**: Automatische Entfernung von Raumnamen aus Entity-Namen